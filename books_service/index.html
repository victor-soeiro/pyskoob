
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../author_service/">
      
      
        <link rel="next" href="../publishers_service/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Books Service - PySkoob</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#books-service" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="PySkoob" class="md-header__button md-logo" aria-label="PySkoob" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PySkoob
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Books Service
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/victor-soeiro/pyskoob" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="PySkoob" class="md-nav__button md-logo" aria-label="PySkoob" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    PySkoob
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/victor-soeiro/pyskoob" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Services
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../author_service/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Author Service
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Books Service
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Books Service
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyskoob.books.BookService" class="md-nav__link">
    <span class="md-ellipsis">
      BookService
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyskoob.books.BookService.get_by_id" class="md-nav__link">
    <span class="md-ellipsis">
      get_by_id
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyskoob.books.BookService.get_reviews" class="md-nav__link">
    <span class="md-ellipsis">
      get_reviews
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyskoob.books.BookService.get_users_by_status" class="md-nav__link">
    <span class="md-ellipsis">
      get_users_by_status
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyskoob.books.BookService.search" class="md-nav__link">
    <span class="md-ellipsis">
      search
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../publishers_service/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Publisher Service
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../users_service/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Users Service
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../profile_service/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Profile Service
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../advanced_usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Advanced Usage
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../stable_api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Stable Public API
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyskoob.books.BookService" class="md-nav__link">
    <span class="md-ellipsis">
      BookService
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyskoob.books.BookService.get_by_id" class="md-nav__link">
    <span class="md-ellipsis">
      get_by_id
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyskoob.books.BookService.get_reviews" class="md-nav__link">
    <span class="md-ellipsis">
      get_reviews
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyskoob.books.BookService.get_users_by_status" class="md-nav__link">
    <span class="md-ellipsis">
      get_users_by_status
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyskoob.books.BookService.search" class="md-nav__link">
    <span class="md-ellipsis">
      search
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="books-service">Books Service</h1>
<p>The <code>BookService</code> allows searching for books and retrieving detailed information.</p>
<h2 id="example">Example</h2>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pyskoob</span><span class="w"> </span><span class="kn">import</span> <span class="n">SkoobClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyskoob.models.enums</span><span class="w"> </span><span class="kn">import</span> <span class="n">BookSearch</span>

<span class="k">with</span> <span class="n">SkoobClient</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">books</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Duna&quot;</span><span class="p">,</span> <span class="n">BookSearch</span><span class="o">.</span><span class="n">TITLE</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">book_id</span><span class="p">)</span>
</code></pre></div>



<div class="doc doc-object doc-class">



<a id="pyskoob.books.BookService"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pyskoob.internal.base.BaseSkoobService">BaseSkoobService</span></code></p>


        <p>High level operations for retrieving and searching books.</p>
<p>The service parses HTML and JSON responses from Skoob and exposes
helpers to fetch book details, reviews and user lists. It can be used
independently from authentication, but other services may combine it
with :class:<code>AuthService</code> to operate on the authenticated user's data.</p>







              <details class="quote">
                <summary>Source code in <code>pyskoob/books.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BookService</span><span class="p">(</span><span class="n">BaseSkoobService</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;High level operations for retrieving and searching books.</span>

<span class="sd">    The service parses HTML and JSON responses from Skoob and exposes</span>
<span class="sd">    helpers to fetch book details, reviews and user lists. It can be used</span>
<span class="sd">    independently from authentication, but other services may combine it</span>
<span class="sd">    with :class:`AuthService` to operate on the authenticated user&#39;s data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">search_by</span><span class="p">:</span> <span class="n">BookSearch</span> <span class="o">=</span> <span class="n">BookSearch</span><span class="o">.</span><span class="n">TITLE</span><span class="p">,</span>
        <span class="n">page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pagination</span><span class="p">[</span><span class="n">BookSearchResult</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Searches for books by query and type.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        query : str</span>
<span class="sd">            The search query string.</span>
<span class="sd">        search_by : BookSearch, optional</span>
<span class="sd">            The type of search (title, author, etc.), by default</span>
<span class="sd">            ``BookSearch.TITLE``.</span>
<span class="sd">        page : int, optional</span>
<span class="sd">            The page number for pagination, by default 1.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Pagination[BookSearchResult]</span>
<span class="sd">            A paginated list of search results.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ParsingError</span>
<span class="sd">            If the HTML structure changes and parsing fails.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; service.search(&quot;Duna&quot;).results[0].title</span>
<span class="sd">        &#39;Duna&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/livro/lista/busca:</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">/tipo:</span><span class="si">{</span><span class="n">search_by</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">/mpage:</span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Searching for books with query: &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39; on page </span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="n">soup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_html</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

            <span class="n">limit</span> <span class="o">=</span> <span class="mi">30</span>
            <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">BookSearchResult</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parse_search_result</span><span class="p">(</span><span class="n">book_div</span><span class="p">)</span> <span class="k">for</span> <span class="n">book_div</span> <span class="ow">in</span> <span class="n">safe_find_all</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;box_lista_busca_vertical&quot;</span><span class="p">})</span>
            <span class="p">]</span>
            <span class="n">cleaned_results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">BookSearchResult</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="n">i</span><span class="p">]</span>

            <span class="n">total_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_total_results</span><span class="p">(</span><span class="n">soup</span><span class="p">)</span>
            <span class="n">next_page_link</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">page</span> <span class="o">*</span> <span class="n">limit</span> <span class="o">&lt;</span> <span class="n">total_results</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to parse book search results: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ParsingError</span><span class="p">(</span><span class="s2">&quot;Failed to parse book search results.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;An unexpected error occurred during book search: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">ParsingError</span><span class="p">(</span><span class="s2">&quot;An unexpected error occurred during book search.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Found </span><span class="si">%s</span><span class="s2"> books on page </span><span class="si">%s</span><span class="s2">, total </span><span class="si">%s</span><span class="s2"> results.&quot;</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">),</span>
            <span class="n">page</span><span class="p">,</span>
            <span class="n">total_results</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">Pagination</span><span class="p">[</span><span class="n">BookSearchResult</span><span class="p">](</span>
            <span class="n">results</span><span class="o">=</span><span class="n">cleaned_results</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
            <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span>
            <span class="n">total</span><span class="o">=</span><span class="n">total_results</span><span class="p">,</span>
            <span class="n">has_next_page</span><span class="o">=</span><span class="n">next_page_link</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edition_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Book</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves a book by its edition ID.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        edition_id : int</span>
<span class="sd">            The edition ID of the book.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Book</span>
<span class="sd">            Book object populated with detailed information.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        FileNotFoundError</span>
<span class="sd">            If no book is found with the given edition_id.</span>
<span class="sd">        ParsingError</span>
<span class="sd">            If parsing or HTTP errors occur.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; service.get_by_id(1).title</span>
<span class="sd">        &#39;Some Book&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Getting book by edition_id: </span><span class="si">{</span><span class="n">edition_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/v1/book/</span><span class="si">{</span><span class="n">edition_id</span><span class="si">}</span><span class="s2">/stats:true&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="n">json_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;response&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">json_data</span><span class="p">:</span>
                <span class="n">cod_description</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cod_description&quot;</span><span class="p">,</span> <span class="s2">&quot;No description provided.&quot;</span><span class="p">)</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;No data found for edition_id </span><span class="si">{</span><span class="n">edition_id</span><span class="si">}</span><span class="s2">. Description: </span><span class="si">{</span><span class="n">cod_description</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_clean_book_json_data</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
            <span class="n">book</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Successfully retrieved book: &#39;</span><span class="si">%s</span><span class="s2">&#39; (Edition ID: </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
                <span class="n">book</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                <span class="n">edition_id</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">book</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Error retrieving book for edition_id </span><span class="si">{</span><span class="n">edition_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">ParsingError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to retrieve book for edition_id </span><span class="si">{</span><span class="n">edition_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_reviews</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">book_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">edition_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pagination</span><span class="p">[</span><span class="n">BookReview</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves reviews for a book.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        book_id : int</span>
<span class="sd">            Book ID for which to retrieve reviews.</span>
<span class="sd">        edition_id : int or None, optional</span>
<span class="sd">            Specific edition ID, or auto-detected if None.</span>
<span class="sd">        page : int, optional</span>
<span class="sd">            Page number for pagination, by default 1.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Pagination[BookReview]</span>
<span class="sd">            A paginated list of reviews for the book.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ParsingError</span>
<span class="sd">            If the HTML structure changes or parsing fails.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; service.get_reviews(123).results</span>
<span class="sd">        [...]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/livro/resenhas/</span><span class="si">{</span><span class="n">book_id</span><span class="si">}</span><span class="s2">/mpage:</span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">/limit:50&quot;</span>
        <span class="k">if</span> <span class="n">edition_id</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;/edition:</span><span class="si">{</span><span class="n">edition_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Getting reviews for book_id: </span><span class="si">{</span><span class="n">book_id</span><span class="si">}</span><span class="s2">, page: </span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="n">soup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_html</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">edition_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">edition_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_edition_id_from_reviews_page</span><span class="p">(</span><span class="n">soup</span><span class="p">)</span>
            <span class="n">book_reviews</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">review</span>
                <span class="k">for</span> <span class="n">review</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_parse_review</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">book_id</span><span class="p">,</span> <span class="n">edition_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">safe_find_all</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;resenha\d+&quot;</span><span class="p">)})</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">review</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">]</span>
            <span class="n">next_page_link</span> <span class="o">=</span> <span class="n">safe_find</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;proximo&quot;</span><span class="p">})</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to parse book reviews: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ParsingError</span><span class="p">(</span><span class="s2">&quot;Failed to parse book reviews.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;An unexpected error occurred during review fetching: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">ParsingError</span><span class="p">(</span><span class="s2">&quot;An unexpected error occurred during review fetching.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">book_reviews</span><span class="p">)</span><span class="si">}</span><span class="s2"> reviews on page </span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Pagination</span><span class="p">[</span><span class="n">BookReview</span><span class="p">](</span>
            <span class="n">results</span><span class="o">=</span><span class="n">book_reviews</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
            <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span>
            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">book_reviews</span><span class="p">),</span>
            <span class="n">has_next_page</span><span class="o">=</span><span class="n">next_page_link</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_users_by_status</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">book_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">status</span><span class="p">:</span> <span class="n">BookUserStatus</span><span class="p">,</span>
        <span class="n">edition_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
        <span class="n">page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pagination</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves users who have a book with a specific status.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        book_id : int</span>
<span class="sd">            The ID of the book.</span>
<span class="sd">        status : BookUserStatus</span>
<span class="sd">            The status of the book in the user&#39;s shelf.</span>
<span class="sd">        edition_id : int or None, optional</span>
<span class="sd">            The edition ID of the book, by default None.</span>
<span class="sd">        limit : int, optional</span>
<span class="sd">            The number of users to retrieve per page, by default 500.</span>
<span class="sd">        page : int, optional</span>
<span class="sd">            The page number for pagination, by default 1.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Pagination[int]</span>
<span class="sd">            A paginated list of user IDs.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ParsingError</span>
<span class="sd">            If the HTML structure changes and parsing fails.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; service.get_users_by_status(1, BookUserStatus.READERS).results[:3]</span>
<span class="sd">        [1, 2, 3]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/livro/leitores/</span><span class="si">{</span><span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">book_id</span><span class="si">}</span><span class="s2">/limit:</span><span class="si">{</span><span class="n">limit</span><span class="si">}</span><span class="s2">/page:</span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">edition_id</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;/edition:</span><span class="si">{</span><span class="n">edition_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Getting users for book_id: </span><span class="si">%s</span><span class="s2"> with status &#39;</span><span class="si">%s</span><span class="s2">&#39; on page </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">book_id</span><span class="p">,</span>
            <span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">page</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="n">soup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_html</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">users_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_user_ids_from_html</span><span class="p">(</span><span class="n">soup</span><span class="p">)</span>
            <span class="n">next_page_link</span> <span class="o">=</span> <span class="n">safe_find</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;proximo&quot;</span><span class="p">})</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to parse users by status: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ParsingError</span><span class="p">(</span><span class="s2">&quot;Failed to parse users by status.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;An unexpected error occurred during user status fetching: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">e</span><span class="p">,</span>
                <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">ParsingError</span><span class="p">(</span><span class="s2">&quot;An unexpected error occurred during user status fetching.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Found </span><span class="si">%s</span><span class="s2"> users on page </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">users_id</span><span class="p">),</span>
            <span class="n">page</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">Pagination</span><span class="p">[</span><span class="nb">int</span><span class="p">](</span>
            <span class="n">results</span><span class="o">=</span><span class="n">users_id</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
            <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span>
            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">users_id</span><span class="p">),</span>
            <span class="n">has_next_page</span><span class="o">=</span><span class="n">next_page_link</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_user_ids_from_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">soup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts user IDs from the user list HTML soup.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        soup : Tag</span>
<span class="sd">            BeautifulSoup Tag containing the user list.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of int</span>
<span class="sd">            List of user IDs found on the page.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; html = (</span>
<span class="sd">        ...     &quot;&lt;div class=&#39;livro-leitor-container&#39;&gt;&quot;</span>
<span class="sd">        ...     &quot;&lt;a href=&#39;/usuario/1-name&#39;&gt;&lt;/a&gt;&lt;/div&gt;&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; service._extract_user_ids_from_html(</span>
<span class="sd">        ...     BeautifulSoup(html, &#39;html.parser&#39;)</span>
<span class="sd">        ... )</span>
<span class="sd">        [1]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">users_html</span> <span class="o">=</span> <span class="n">safe_find_all</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;livro-leitor-container&quot;</span><span class="p">})</span>
        <span class="n">users_id</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">user_div</span> <span class="ow">in</span> <span class="n">users_html</span><span class="p">:</span>
            <span class="n">user_link</span> <span class="o">=</span> <span class="n">safe_find</span><span class="p">(</span><span class="n">user_div</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
            <span class="n">href</span> <span class="o">=</span> <span class="n">get_tag_attr</span><span class="p">(</span><span class="n">user_link</span><span class="p">,</span> <span class="s2">&quot;href&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">href</span><span class="p">:</span>
                <span class="n">user_id</span> <span class="o">=</span> <span class="n">get_user_id_from_url</span><span class="p">(</span><span class="n">href</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">user_id</span><span class="p">:</span>
                    <span class="n">users_id</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">user_id</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not extract user ID from URL: </span><span class="si">{</span><span class="n">href</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Skipping user_div due to missing &#39;a&#39; tag or href attribute.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">users_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_edition_id_from_reviews_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">soup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts the edition ID from the reviews page if not provided.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        soup : Tag</span>
<span class="sd">            BeautifulSoup object of the reviews page.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int or None</span>
<span class="sd">            Edition ID or None if not found.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; html = (</span>
<span class="sd">        ...     &quot;&lt;div id=&#39;pg-livro-menu-principal-container&#39;&gt;&quot;</span>
<span class="sd">        ...     &quot;&lt;a href=&#39;/livro/1-ed3&#39;&gt;&lt;/a&gt;&lt;/div&gt;&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; service._extract_edition_id_from_reviews_page(</span>
<span class="sd">        ...     BeautifulSoup(html, &#39;html.parser&#39;)</span>
<span class="sd">        ... )</span>
<span class="sd">        3</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">menu_div</span> <span class="o">=</span> <span class="n">safe_find</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;pg-livro-menu-principal-container&quot;</span><span class="p">})</span>
        <span class="n">menu_div_a</span> <span class="o">=</span> <span class="n">safe_find</span><span class="p">(</span><span class="n">menu_div</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">menu_div</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">href</span> <span class="o">=</span> <span class="n">get_tag_attr</span><span class="p">(</span><span class="n">menu_div_a</span><span class="p">,</span> <span class="s2">&quot;href&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">href</span><span class="p">:</span>
            <span class="n">extracted_edition_id</span> <span class="o">=</span> <span class="n">get_book_edition_id_from_url</span><span class="p">(</span><span class="n">href</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">extracted_edition_id</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">extracted_edition_id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not extract edition_id from URL: </span><span class="si">{</span><span class="n">href</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_review</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">r</span><span class="p">:</span> <span class="n">Tag</span><span class="p">,</span>
        <span class="n">book_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">edition_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BookReview</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parses a single review div into a BookReview object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        r : Tag</span>
<span class="sd">            BeautifulSoup Tag for the review.</span>
<span class="sd">        book_id : int</span>
<span class="sd">            The book ID.</span>
<span class="sd">        edition_id : int or None</span>
<span class="sd">            The edition ID.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        BookReview or None</span>
<span class="sd">            Parsed review or None if incomplete.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; html = &quot;&lt;div id=&#39;resenha1&#39;&gt;&lt;/div&gt;&quot;</span>
<span class="sd">        &gt;&gt;&gt; service._parse_review(</span>
<span class="sd">        ...     BeautifulSoup(html, &#39;html.parser&#39;),</span>
<span class="sd">        ...     1,</span>
<span class="sd">        ...     None,</span>
<span class="sd">        ... )</span>
<span class="sd">        ... # doctest: +ELLIPSIS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">review_id_str</span> <span class="o">=</span> <span class="n">get_tag_attr</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">)</span>
        <span class="n">review_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">review_id_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;resenha&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">if</span> <span class="n">review_id_str</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">review_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping review due to missing or invalid ID: </span><span class="si">{</span><span class="n">get_tag_attr</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">user_link</span> <span class="o">=</span> <span class="n">safe_find</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;href&quot;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/usuario/&quot;</span><span class="p">)})</span>
        <span class="n">user_url</span> <span class="o">=</span> <span class="n">get_tag_attr</span><span class="p">(</span><span class="n">user_link</span><span class="p">,</span> <span class="s2">&quot;href&quot;</span><span class="p">)</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">get_user_id_from_url</span><span class="p">(</span><span class="n">user_url</span><span class="p">))</span> <span class="k">if</span> <span class="n">user_url</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping review </span><span class="si">{</span><span class="n">review_id</span><span class="si">}</span><span class="s2"> due to missing user ID.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">star_tag</span> <span class="o">=</span> <span class="n">safe_find</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s2">&quot;star-rating&quot;</span><span class="p">)</span>
        <span class="n">rating</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">get_tag_attr</span><span class="p">(</span><span class="n">star_tag</span><span class="p">,</span> <span class="s2">&quot;rate&quot;</span><span class="p">))</span> <span class="k">if</span> <span class="n">star_tag</span> <span class="ow">and</span> <span class="n">get_tag_attr</span><span class="p">(</span><span class="n">star_tag</span><span class="p">,</span> <span class="s2">&quot;rate&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="mf">0.0</span>
        <span class="n">comment_div</span> <span class="o">=</span> <span class="n">safe_find</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;resenhac\d+&quot;</span><span class="p">)})</span>
        <span class="n">date</span><span class="p">,</span> <span class="n">review_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_review_date_and_text</span><span class="p">(</span><span class="n">comment_div</span><span class="p">,</span> <span class="n">review_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">BookReview</span><span class="p">(</span>
            <span class="n">review_id</span><span class="o">=</span><span class="n">review_id</span><span class="p">,</span>
            <span class="n">book_id</span><span class="o">=</span><span class="n">book_id</span><span class="p">,</span>
            <span class="n">edition_id</span><span class="o">=</span><span class="n">edition_id</span><span class="p">,</span>
            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
            <span class="n">rating</span><span class="o">=</span><span class="n">rating</span><span class="p">,</span>
            <span class="n">review_text</span><span class="o">=</span><span class="n">review_text</span><span class="p">,</span>
            <span class="n">reviewed_at</span><span class="o">=</span><span class="n">date</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_review_date_and_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comment_div</span><span class="p">:</span> <span class="n">Tag</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">review_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts the review date and text from the comment div.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        comment_div : Tag</span>
<span class="sd">            BeautifulSoup Tag containing the review comment.</span>
<span class="sd">        review_id : int</span>
<span class="sd">            ID of the review (for logging purposes).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple of (datetime or None, str)</span>
<span class="sd">            Parsed review date (if found) and review text.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; soup = BeautifulSoup(</span>
<span class="sd">        ...     &#39;&lt;span&gt;01/01/2020&lt;/span&gt; Great&#39;,</span>
<span class="sd">        ...     &#39;html.parser&#39;,</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; service._extract_review_date_and_text(soup, 1)[1]</span>
<span class="sd">        &#39;Great&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">date</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">review_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">comment_div</span><span class="p">:</span>
            <span class="n">date_span</span> <span class="o">=</span> <span class="n">safe_find</span><span class="p">(</span><span class="n">comment_div</span><span class="p">,</span> <span class="s2">&quot;span&quot;</span><span class="p">)</span>
            <span class="n">date_text</span> <span class="o">=</span> <span class="n">get_tag_text</span><span class="p">(</span><span class="n">date_span</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">date_text</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_text</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not parse date &#39;</span><span class="si">{</span><span class="n">date_text</span><span class="si">}</span><span class="s2">&#39; for review </span><span class="si">{</span><span class="n">review_id</span><span class="si">}</span><span class="s2">. Setting to None.&quot;</span><span class="p">)</span>
            <span class="n">content_parts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">date_span</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">sibling</span> <span class="ow">in</span> <span class="n">date_span</span><span class="o">.</span><span class="n">next_siblings</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sibling</span><span class="p">,</span> <span class="n">Tag</span><span class="p">):</span>
                        <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sibling</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="n">separator</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sibling</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="n">stripped_text</span> <span class="o">=</span> <span class="n">sibling</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">stripped_text</span><span class="p">:</span>
                            <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stripped_text</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comment_div</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="n">separator</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="n">review_text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">content_parts</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">date</span><span class="p">,</span> <span class="n">review_text</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_search_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">book_div</span><span class="p">:</span> <span class="n">Tag</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BookSearchResult</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parses a single book search result div into a BookSearchResult object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        book_div : Tag</span>
<span class="sd">            BeautifulSoup Tag for a single search result.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        BookSearchResult or None</span>
<span class="sd">            Parsed result or None if data is incomplete.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; html = &quot;&lt;a class=&#39;capa-link-item&#39; title=&#39;X&#39; href=&#39;/livro/1-ed2&#39;&gt;&lt;/a&gt;&quot;</span>
<span class="sd">        &gt;&gt;&gt; service._parse_search_result(BeautifulSoup(html, &#39;html.parser&#39;))</span>
<span class="sd">        BookSearchResult(...)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">container</span> <span class="o">=</span> <span class="n">safe_find</span><span class="p">(</span><span class="n">book_div</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;capa-link-item&quot;</span><span class="p">})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">container</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Skipping book_div due to missing &#39;capa-link-item&#39; container.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">title</span> <span class="o">=</span> <span class="n">get_tag_attr</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">)</span>
        <span class="n">book_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}{</span><span class="n">get_tag_attr</span><span class="p">(</span><span class="n">container</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;href&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">img_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_img_url</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">book_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">get_book_id_from_url</span><span class="p">(</span><span class="n">book_url</span><span class="p">))</span>
            <span class="n">edition_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">get_book_edition_id_from_url</span><span class="p">(</span><span class="n">book_url</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping book_div due to invalid book/edition id in url: </span><span class="si">{</span><span class="n">book_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">publisher</span><span class="p">,</span> <span class="n">isbn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_publisher_and_isbn</span><span class="p">(</span><span class="n">book_div</span><span class="p">)</span>
        <span class="n">rating</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_rating</span><span class="p">(</span><span class="n">book_div</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">BookSearchResult</span><span class="p">(</span>
            <span class="n">edition_id</span><span class="o">=</span><span class="n">edition_id</span><span class="p">,</span>
            <span class="n">book_id</span><span class="o">=</span><span class="n">book_id</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">publisher</span><span class="o">=</span><span class="n">publisher</span><span class="p">,</span>
            <span class="n">isbn</span><span class="o">=</span><span class="n">isbn</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">book_url</span><span class="p">,</span>
            <span class="n">cover_url</span><span class="o">=</span><span class="n">img_url</span><span class="p">,</span>
            <span class="n">rating</span><span class="o">=</span><span class="n">rating</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_img_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">container</span><span class="p">:</span> <span class="n">Tag</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts the image URL from the book cover container.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        container : Tag</span>
<span class="sd">            BeautifulSoup Tag for the image container.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            URL of the book cover image or an empty string if not found.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; html = &quot;&lt;a&gt;&lt;img src=&#39;https://img.com/c.jpg&#39;&gt;&lt;/a&gt;&quot;</span>
<span class="sd">        &gt;&gt;&gt; service._extract_img_url(BeautifulSoup(html, &#39;html.parser&#39;).a)</span>
<span class="sd">        &#39;https://img.com/c.jpg&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">container</span><span class="o">.</span><span class="n">img</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">img</span><span class="p">,</span> <span class="n">Tag</span><span class="p">):</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">get_tag_attr</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">img</span><span class="p">,</span> <span class="s2">&quot;src&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">src</span> <span class="ow">and</span> <span class="s2">&quot;https&quot;</span> <span class="ow">in</span> <span class="n">src</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;https</span><span class="si">{</span><span class="n">src</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;https&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_publisher_and_isbn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">book_div</span><span class="p">:</span> <span class="n">Tag</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts publisher and ISBN information from a book search result div.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        book_div : Tag</span>
<span class="sd">            BeautifulSoup Tag for the book search result.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple of (str or None, str or None)</span>
<span class="sd">            Publisher and ISBN string or None if not found.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; html = &quot;&lt;div class=&#39;detalhes-2-sub&#39;&gt;&lt;div&gt;&lt;span&gt;Editora&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&quot;</span>
<span class="sd">        &gt;&gt;&gt; service._extract_publisher_and_isbn(BeautifulSoup(html, &#39;html.parser&#39;))</span>
<span class="sd">        (&#39;Editora&#39;, None)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">detalhes2sub</span> <span class="o">=</span> <span class="n">safe_find</span><span class="p">(</span><span class="n">book_div</span><span class="p">,</span> <span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;detalhes-2-sub&quot;</span><span class="p">})</span>
        <span class="n">detalhes2sub_div</span> <span class="o">=</span> <span class="n">detalhes2sub</span><span class="o">.</span><span class="n">div</span> <span class="k">if</span> <span class="n">detalhes2sub</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">spans</span> <span class="o">=</span> <span class="n">safe_find_all</span><span class="p">(</span><span class="n">detalhes2sub_div</span><span class="p">,</span> <span class="s2">&quot;span&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">detalhes2sub_div</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="n">cleaned_spans</span> <span class="o">=</span> <span class="p">[</span><span class="n">text</span> <span class="k">for</span> <span class="n">span</span> <span class="ow">in</span> <span class="n">spans</span> <span class="k">if</span> <span class="p">(</span><span class="n">text</span> <span class="o">:=</span> <span class="n">span</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span> <span class="ow">and</span> <span class="n">text</span> <span class="o">!=</span> <span class="s2">&quot;|&quot;</span><span class="p">]</span>
        <span class="n">isbn_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\d{9,13}$|^B0[A-Z0-9]{8,}$&quot;</span><span class="p">)</span>
        <span class="n">isbn</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">publisher</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">cleaned_spans</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">isbn_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">cleaned_spans</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">isbn</span> <span class="o">=</span> <span class="n">cleaned_spans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned_spans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">publisher</span> <span class="o">=</span> <span class="n">cleaned_spans</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">publisher</span><span class="p">,</span> <span class="n">isbn</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_rating</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">book_div</span><span class="p">:</span> <span class="n">Tag</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts the rating value from a search result div.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        book_div : Tag</span>
<span class="sd">            BeautifulSoup Tag for the book search result.</span>
<span class="sd">        title : str</span>
<span class="sd">            Title of the book (for logging purposes).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float or None</span>
<span class="sd">            The rating or None if not found or parsing fails.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; html = &quot;&lt;div class=&#39;star-mini&#39;&gt;&lt;strong&gt;4,5&lt;/strong&gt;&lt;/div&gt;&quot;</span>
<span class="sd">        &gt;&gt;&gt; service._extract_rating(BeautifulSoup(html, &#39;html.parser&#39;), &#39;Example&#39;)</span>
<span class="sd">        4.5</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">star_mini</span> <span class="o">=</span> <span class="n">safe_find</span><span class="p">(</span><span class="n">book_div</span><span class="p">,</span> <span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;star-mini&quot;</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">star_mini</span><span class="p">:</span>
            <span class="n">strong_tag</span> <span class="o">=</span> <span class="n">safe_find</span><span class="p">(</span><span class="n">star_mini</span><span class="p">,</span> <span class="s2">&quot;strong&quot;</span><span class="p">)</span>
            <span class="n">rating_text</span> <span class="o">=</span> <span class="n">get_tag_text</span><span class="p">(</span><span class="n">strong_tag</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rating_text</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">rating_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not parse rating &#39;</span><span class="si">{</span><span class="n">rating_text</span><span class="si">}</span><span class="s2">&#39; for book &#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&#39;. Setting to None.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_total_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">soup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts the total number of search results from the soup.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        soup : Tag</span>
<span class="sd">            Parsed BeautifulSoup object of the search result page.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Total number of results, or 0 if not found.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; service._extract_total_results(BeautifulSoup(&quot;&lt;div class=&#39;contador&#39;&gt;1 encontrados&lt;/div&gt;&quot;, &#39;html.parser&#39;))</span>
<span class="sd">        1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">total_results_tag</span> <span class="o">=</span> <span class="n">safe_find</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;contador&quot;</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">total_results_tag</span><span class="p">:</span>
            <span class="n">total_results_text</span> <span class="o">=</span> <span class="n">get_tag_text</span><span class="p">(</span><span class="n">total_results_tag</span><span class="p">)</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\d+)\s+encontrados&quot;</span><span class="p">,</span> <span class="n">total_results_text</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_clean_book_json_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">json_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cleans and normalizes the JSON data returned from the API before model validation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        json_data : dict</span>
<span class="sd">            Dictionary from the API response, modified in place.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; data = {&quot;url&quot;: &quot;/book&quot;, &quot;isbn&quot;: &quot;0&quot;}</span>
<span class="sd">        &gt;&gt;&gt; service._clean_book_json_data(data)</span>
<span class="sd">        &gt;&gt;&gt; data[&quot;cover_url&quot;]</span>
<span class="sd">        &#39;&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}{</span><span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;isbn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;isbn&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span> <span class="k">else</span> <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;isbn&quot;</span><span class="p">]</span>
        <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;autor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;autor&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;no especificado&quot;</span> <span class="k">else</span> <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;autor&quot;</span><span class="p">]</span>
        <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;serie&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;serie&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">None</span>
        <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;volume&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">])</span>
        <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;mes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mes&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;mes&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;mes&quot;</span><span class="p">]</span>
        <span class="n">img_url</span> <span class="o">=</span> <span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;img_url&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;cover_url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https</span><span class="si">{</span><span class="n">img_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;https&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">img_url</span> <span class="ow">and</span> <span class="s2">&quot;https&quot;</span> <span class="ow">in</span> <span class="n">img_url</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">generos</span> <span class="o">=</span> <span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;generos&quot;</span><span class="p">)</span>
        <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;generos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generos</span> <span class="k">if</span> <span class="n">generos</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="pyskoob.books.BookService.get_by_id" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_by_id</span><span class="p">(</span><span class="n">edition_id</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Retrieves a book by its edition ID.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>edition_id</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The edition ID of the book.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pyskoob.models.book.Book">Book</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Book object populated with detailed information.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no book is found with the given edition_id.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pyskoob.exceptions.ParsingError">ParsingError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If parsing or HTTP errors occur.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="codehilite"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">service</span><span class="o">.</span><span class="n">get_by_id</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">title</span>
<span class="go">&#39;Some Book&#39;</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>pyskoob/books.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edition_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Book</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves a book by its edition ID.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    edition_id : int</span>
<span class="sd">        The edition ID of the book.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Book</span>
<span class="sd">        Book object populated with detailed information.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    FileNotFoundError</span>
<span class="sd">        If no book is found with the given edition_id.</span>
<span class="sd">    ParsingError</span>
<span class="sd">        If parsing or HTTP errors occur.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; service.get_by_id(1).title</span>
<span class="sd">    &#39;Some Book&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Getting book by edition_id: </span><span class="si">{</span><span class="n">edition_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/v1/book/</span><span class="si">{</span><span class="n">edition_id</span><span class="si">}</span><span class="s2">/stats:true&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="n">json_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;response&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">json_data</span><span class="p">:</span>
            <span class="n">cod_description</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cod_description&quot;</span><span class="p">,</span> <span class="s2">&quot;No description provided.&quot;</span><span class="p">)</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;No data found for edition_id </span><span class="si">{</span><span class="n">edition_id</span><span class="si">}</span><span class="s2">. Description: </span><span class="si">{</span><span class="n">cod_description</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clean_book_json_data</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
        <span class="n">book</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Successfully retrieved book: &#39;</span><span class="si">%s</span><span class="s2">&#39; (Edition ID: </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="n">book</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
            <span class="n">edition_id</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">book</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="k">raise</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Error retrieving book for edition_id </span><span class="si">{</span><span class="n">edition_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="n">ParsingError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to retrieve book for edition_id </span><span class="si">{</span><span class="n">edition_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="pyskoob.books.BookService.get_reviews" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_reviews</span><span class="p">(</span><span class="n">book_id</span><span class="p">,</span> <span class="n">edition_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Retrieves reviews for a book.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>book_id</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Book ID for which to retrieve reviews.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>edition_id</code>
            </td>
            <td>
                  <code><span title="int">int</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific edition ID, or auto-detected if None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Page number for pagination, by default 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pyskoob.models.pagination.Pagination">Pagination</span>[<span title="pyskoob.models.book.BookReview">BookReview</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A paginated list of reviews for the book.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pyskoob.exceptions.ParsingError">ParsingError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the HTML structure changes or parsing fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="codehilite"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">service</span><span class="o">.</span><span class="n">get_reviews</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span><span class="o">.</span><span class="n">results</span>
<span class="go">[...]</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>pyskoob/books.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_reviews</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">book_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">edition_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pagination</span><span class="p">[</span><span class="n">BookReview</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves reviews for a book.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    book_id : int</span>
<span class="sd">        Book ID for which to retrieve reviews.</span>
<span class="sd">    edition_id : int or None, optional</span>
<span class="sd">        Specific edition ID, or auto-detected if None.</span>
<span class="sd">    page : int, optional</span>
<span class="sd">        Page number for pagination, by default 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Pagination[BookReview]</span>
<span class="sd">        A paginated list of reviews for the book.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ParsingError</span>
<span class="sd">        If the HTML structure changes or parsing fails.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; service.get_reviews(123).results</span>
<span class="sd">    [...]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/livro/resenhas/</span><span class="si">{</span><span class="n">book_id</span><span class="si">}</span><span class="s2">/mpage:</span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">/limit:50&quot;</span>
    <span class="k">if</span> <span class="n">edition_id</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;/edition:</span><span class="si">{</span><span class="n">edition_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Getting reviews for book_id: </span><span class="si">{</span><span class="n">book_id</span><span class="si">}</span><span class="s2">, page: </span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="n">soup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_html</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">edition_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">edition_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_edition_id_from_reviews_page</span><span class="p">(</span><span class="n">soup</span><span class="p">)</span>
        <span class="n">book_reviews</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">review</span>
            <span class="k">for</span> <span class="n">review</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parse_review</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">book_id</span><span class="p">,</span> <span class="n">edition_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">safe_find_all</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;resenha\d+&quot;</span><span class="p">)})</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">review</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">]</span>
        <span class="n">next_page_link</span> <span class="o">=</span> <span class="n">safe_find</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;proximo&quot;</span><span class="p">})</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to parse book reviews: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">ParsingError</span><span class="p">(</span><span class="s2">&quot;Failed to parse book reviews.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;An unexpected error occurred during review fetching: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="n">ParsingError</span><span class="p">(</span><span class="s2">&quot;An unexpected error occurred during review fetching.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">book_reviews</span><span class="p">)</span><span class="si">}</span><span class="s2"> reviews on page </span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Pagination</span><span class="p">[</span><span class="n">BookReview</span><span class="p">](</span>
        <span class="n">results</span><span class="o">=</span><span class="n">book_reviews</span><span class="p">,</span>
        <span class="n">limit</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
        <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span>
        <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">book_reviews</span><span class="p">),</span>
        <span class="n">has_next_page</span><span class="o">=</span><span class="n">next_page_link</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="pyskoob.books.BookService.get_users_by_status" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_users_by_status</span><span class="p">(</span><span class="n">book_id</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">edition_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Retrieves users who have a book with a specific status.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>book_id</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ID of the book.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>status</code>
            </td>
            <td>
                  <code><span title="pyskoob.models.enums.BookUserStatus">BookUserStatus</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The status of the book in the user's shelf.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>edition_id</code>
            </td>
            <td>
                  <code><span title="int">int</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The edition ID of the book, by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of users to retrieve per page, by default 500.</p>
              </div>
            </td>
            <td>
                  <code>500</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The page number for pagination, by default 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pyskoob.models.pagination.Pagination">Pagination</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A paginated list of user IDs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pyskoob.exceptions.ParsingError">ParsingError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the HTML structure changes and parsing fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="codehilite"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">service</span><span class="o">.</span><span class="n">get_users_by_status</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">BookUserStatus</span><span class="o">.</span><span class="n">READERS</span><span class="p">)</span><span class="o">.</span><span class="n">results</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
<span class="go">[1, 2, 3]</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>pyskoob/books.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_users_by_status</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">book_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">BookUserStatus</span><span class="p">,</span>
    <span class="n">edition_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pagination</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves users who have a book with a specific status.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    book_id : int</span>
<span class="sd">        The ID of the book.</span>
<span class="sd">    status : BookUserStatus</span>
<span class="sd">        The status of the book in the user&#39;s shelf.</span>
<span class="sd">    edition_id : int or None, optional</span>
<span class="sd">        The edition ID of the book, by default None.</span>
<span class="sd">    limit : int, optional</span>
<span class="sd">        The number of users to retrieve per page, by default 500.</span>
<span class="sd">    page : int, optional</span>
<span class="sd">        The page number for pagination, by default 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Pagination[int]</span>
<span class="sd">        A paginated list of user IDs.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ParsingError</span>
<span class="sd">        If the HTML structure changes and parsing fails.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; service.get_users_by_status(1, BookUserStatus.READERS).results[:3]</span>
<span class="sd">    [1, 2, 3]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/livro/leitores/</span><span class="si">{</span><span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">book_id</span><span class="si">}</span><span class="s2">/limit:</span><span class="si">{</span><span class="n">limit</span><span class="si">}</span><span class="s2">/page:</span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="n">edition_id</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;/edition:</span><span class="si">{</span><span class="n">edition_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Getting users for book_id: </span><span class="si">%s</span><span class="s2"> with status &#39;</span><span class="si">%s</span><span class="s2">&#39; on page </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">book_id</span><span class="p">,</span>
        <span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">page</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="n">soup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_html</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">users_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_user_ids_from_html</span><span class="p">(</span><span class="n">soup</span><span class="p">)</span>
        <span class="n">next_page_link</span> <span class="o">=</span> <span class="n">safe_find</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;proximo&quot;</span><span class="p">})</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to parse users by status: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">ParsingError</span><span class="p">(</span><span class="s2">&quot;Failed to parse users by status.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;An unexpected error occurred during user status fetching: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">e</span><span class="p">,</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="n">ParsingError</span><span class="p">(</span><span class="s2">&quot;An unexpected error occurred during user status fetching.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Found </span><span class="si">%s</span><span class="s2"> users on page </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">users_id</span><span class="p">),</span>
        <span class="n">page</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">Pagination</span><span class="p">[</span><span class="nb">int</span><span class="p">](</span>
        <span class="n">results</span><span class="o">=</span><span class="n">users_id</span><span class="p">,</span>
        <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
        <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span>
        <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">users_id</span><span class="p">),</span>
        <span class="n">has_next_page</span><span class="o">=</span><span class="n">next_page_link</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="pyskoob.books.BookService.search" class="doc doc-heading">
            <code class=" language-python"><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">search_by</span><span class="o">=</span><span class="n">BookSearch</span><span class="o">.</span><span class="n">TITLE</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Searches for books by query and type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>query</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The search query string.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>search_by</code>
            </td>
            <td>
                  <code><span title="pyskoob.models.enums.BookSearch">BookSearch</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of search (title, author, etc.), by default
<code>BookSearch.TITLE</code>.</p>
              </div>
            </td>
            <td>
                  <code><span title="pyskoob.models.enums.BookSearch.TITLE">TITLE</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The page number for pagination, by default 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pyskoob.models.pagination.Pagination">Pagination</span>[<span title="pyskoob.models.book.BookSearchResult">BookSearchResult</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A paginated list of search results.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pyskoob.exceptions.ParsingError">ParsingError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the HTML structure changes and parsing fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="codehilite"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">service</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Duna&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">title</span>
<span class="go">&#39;Duna&#39;</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>pyskoob/books.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">search_by</span><span class="p">:</span> <span class="n">BookSearch</span> <span class="o">=</span> <span class="n">BookSearch</span><span class="o">.</span><span class="n">TITLE</span><span class="p">,</span>
    <span class="n">page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pagination</span><span class="p">[</span><span class="n">BookSearchResult</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Searches for books by query and type.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    query : str</span>
<span class="sd">        The search query string.</span>
<span class="sd">    search_by : BookSearch, optional</span>
<span class="sd">        The type of search (title, author, etc.), by default</span>
<span class="sd">        ``BookSearch.TITLE``.</span>
<span class="sd">    page : int, optional</span>
<span class="sd">        The page number for pagination, by default 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Pagination[BookSearchResult]</span>
<span class="sd">        A paginated list of search results.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ParsingError</span>
<span class="sd">        If the HTML structure changes and parsing fails.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; service.search(&quot;Duna&quot;).results[0].title</span>
<span class="sd">    &#39;Duna&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/livro/lista/busca:</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">/tipo:</span><span class="si">{</span><span class="n">search_by</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">/mpage:</span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Searching for books with query: &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39; on page </span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="n">soup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_html</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="n">limit</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">BookSearchResult</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_search_result</span><span class="p">(</span><span class="n">book_div</span><span class="p">)</span> <span class="k">for</span> <span class="n">book_div</span> <span class="ow">in</span> <span class="n">safe_find_all</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;box_lista_busca_vertical&quot;</span><span class="p">})</span>
        <span class="p">]</span>
        <span class="n">cleaned_results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">BookSearchResult</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="n">i</span><span class="p">]</span>

        <span class="n">total_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_total_results</span><span class="p">(</span><span class="n">soup</span><span class="p">)</span>
        <span class="n">next_page_link</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">page</span> <span class="o">*</span> <span class="n">limit</span> <span class="o">&lt;</span> <span class="n">total_results</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to parse book search results: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">ParsingError</span><span class="p">(</span><span class="s2">&quot;Failed to parse book search results.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;An unexpected error occurred during book search: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="n">ParsingError</span><span class="p">(</span><span class="s2">&quot;An unexpected error occurred during book search.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Found </span><span class="si">%s</span><span class="s2"> books on page </span><span class="si">%s</span><span class="s2">, total </span><span class="si">%s</span><span class="s2"> results.&quot;</span><span class="p">,</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">),</span>
        <span class="n">page</span><span class="p">,</span>
        <span class="n">total_results</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">Pagination</span><span class="p">[</span><span class="n">BookSearchResult</span><span class="p">](</span>
        <span class="n">results</span><span class="o">=</span><span class="n">cleaned_results</span><span class="p">,</span>
        <span class="n">limit</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span>
        <span class="n">total</span><span class="o">=</span><span class="n">total_results</span><span class="p">,</span>
        <span class="n">has_next_page</span><span class="o">=</span><span class="n">next_page_link</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>